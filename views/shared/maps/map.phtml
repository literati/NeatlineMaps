<script type="text/javascript"
	src="http://openlayers.org/api/OpenLayers.js">Ê</script>
<script type="text/javascript"
	src="http://ajax.googleapis.com/ajax/libs/jquery/1.4/jquery.min.js">Ê</script>
<script type="text/javascript"
	src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7/jquery-ui.min.js">Ê</script>

<?php 
echo js('proj4js/proj4js-compressed');
echo js('maps/show/show');
?>

<link rel="stylesheet" href="<?php echo css('show'); ?>" />
<link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.2/themes/overcast/jquery-ui.css" type="text/css" />

<script type="text/javascript"><?php echo $params['proj4js'] ?></script>

<div id="NLtmp" class="themap"></div>
<div id="mappanel" class="olControlEditingToolbar"></div>
<div id="addlayerdialog">
<div id="mappreview"></div>
<?php

$items = get_items(array('type' => neatlinemaps_getMapItemType() ), 200);
$itemnames = array();
$itemids = array();
foreach ($items as $item) {
	array_push($itemnames,item("Dublin Core", "Title", array(), $item));
	array_push($itemids,$item->id);
}
$options = array_combine($itemids,$itemnames);
echo $this->formSelect("layerselect", reset($options), array('class'=>'select'), $options);
?>
</div>
<script type="text/javascript">
		jQuery.noConflict();
		if (typeof (Omeka) == 'undefined') {
			Omeka = new Object();
		}
		
		if (!Omeka.NeatlineMaps) {
			Omeka.NeatlineMaps = new Array();
		}

		if (!Omeka.NeatlineMaps.history) {
			Omeka.NeatlineMaps.history = new Array();
		}
		NLconfig = new Object();

	<?php foreach ($params as $name => $value) {
			echo "NLconfig.$name = '$value';\n"	;
		}
		$dates = $params['dates'];
		if ($dates['date']) { ?>
		NLconfig.date = '<?php echo $dates['date'] ; ?>';
		<?php } if ($dates['start']) { ?>
		NLconfig.startdate = '<?php echo $dates['start'] ; ?>';
		<?php } if ($dates['end']) { ?>
		NLconfig.enddate = '<?php echo $dates['end'] ;  ?>'; <?php } ?>

		NLconfig.backgroundlayers = new Array();
		<?php
		$layers = $params['layers'];
		foreach (array_keys($layers) as $layername) {
			$layerinfo = $layers[$layername];
		  	?>
		  	var layer = new OpenLayers.Layer.WMS('<?php echo $layerinfo['title']; ?>' , '<?php echo $layerinfo['serviceaddy'];?>', {layers: '<?php echo $layername; ?>'})
			layer.Neatline = new Object();
			<?php 
			$dates = $layerinfo['dates'];
			if ($dates['date']) { ?>
			try {
				layer.Neatline.date = new Date('<?php echo $dates['date'] ; ?>');
			}
			catch (err) {
				layer.Neatline.date = '<?php echo $dates['date'] ; ?>';
			}
			<?php } if ($dates['start']) { ?>
			try {
				layer.Neatline.startdate = new Date('<?php echo $dates['start'] ; ?>');
			}
			catch (err) {
				layer.Neatline.startdate = '<?php echo $dates['start'] ; ?>';
			}
			<?php } if ($dates['end']) { ?>
			try {
				layer.Neatline.enddate = new Date('<?php echo $dates['end'] ; ?>'); 
			}
			catch (err) {
				layer.Neatline.enddate = '<?php echo $dates['end'] ; ?>';
			}
			<?php } ?>
		  	NLconfig.backgroundlayers.push(layer);
		  	<?php 
	 	 } 	
		?>
		NLconfig.bbox = new OpenLayers.Bounds(NLconfig.minx,NLconfig.miny,NLconfig.maxx,NLconfig.maxy);
		Omeka.NeatlineMaps.history[Omeka.NeatlineMaps.history.length] = NLconfig;
		NLconfig.mapdiv = "map" + Omeka.NeatlineMaps.history.length;
		document.getElementById('NLtmp').id = NLconfig.mapdiv;	
		Event.observe(window, 'load', Omeka.NeatlineMaps.createMap.bindAsEventListener(this,NLconfig));
		delete(NLconfig);
//-->

</script>
